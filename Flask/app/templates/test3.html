<!DOCTYPE html>
<meta charset="utf-8">
<style>
    @import url(http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz:400,700);
    @import url(http://square.github.io/cubism/style.css);
</style>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="http://square.github.io/cubism/cubism.v1.js"></script>
<div id="body"> <div id="graph" /></div>
 
<script>
// create context and horizon
var context = cubism.context()step(5 * 60 * 1000).size(960)
var horizon = context.horizon().extent([0,100])
 
// define metric accessor
function random_ma(name) {
    return context.metric( function(start, stop, step, callback) {
        var values =[];
        d3.json("/data?start="+ +start+"&stop="+ +stop+"&step="+ +step, function(rows) {
            rows.forEach(function(d) {
                values.push(d);
            });
            callback(null, values);
        });
    }, name);
};

 
// draw graph
var metrics = ["foo","bar","baz"];
horizon.metric(random_ma);
 
d3.select("#graph").selectAll(".horizon")
      .data(metrics)
      .enter()
      .append("div")
      .attr("class", "horizon")
      .call(horizon);
 
// set rule
d3.select("#body").append("div")
  .attr("class", "rule")
  .call(context.rule());
 
// set focus
context.on("focus", function(i) {
    d3.selectAll(".value")
        .style( "right", i == null ? null : context.size() - i + "px");
});
// set axis 
var axis = context.axis()
d3.select("#graph").append("div").attr("class", "axis").append("g").call(axis);
</script>